{"version":3,"sources":["../../../../src/streaming/Stream.js"],"names":[],"mappings":"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","file":"Stream.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport Constants from './constants/Constants';\nimport StreamProcessor from './StreamProcessor';\nimport EventController from './controllers/EventController';\nimport FragmentController from './controllers/FragmentController';\nimport VideoModel from './models/VideoModel';\nimport EventBus from '../core/EventBus';\nimport Events from '../core/events/Events';\nimport Debug from '../core/Debug';\nimport FactoryMaker from '../core/FactoryMaker';\n\nfunction Stream(config) {\n\n    const DATA_UPDATE_FAILED_ERROR_CODE = 1;\n\n    let context = this.context;\n    let log = Debug(context).getInstance().log;\n    let eventBus = EventBus(context).getInstance();\n\n    let manifestModel = config.manifestModel;\n    let dashManifestModel = config.dashManifestModel;\n    let mediaPlayerModel = config.mediaPlayerModel;\n    let manifestUpdater = config.manifestUpdater;\n    let adapter = config.adapter;\n    let capabilities = config.capabilities;\n    let errHandler = config.errHandler;\n    let timelineConverter = config.timelineConverter;\n    let metricsModel = config.metricsModel;\n    let abrController = config.abrController;\n    let playbackController = config.playbackController;\n    let mediaController = config.mediaController;\n    let textController = config.textController;\n\n    let instance,\n        streamProcessors,\n        isStreamActivated,\n        isMediaInitialized,\n        streamInfo,\n        updateError,\n        isUpdating,\n        protectionController,\n        fragmentController,\n        eventController,\n        trackChangedEvent;\n\n    function setup() {\n        resetInitialSettings();\n\n        fragmentController = FragmentController(context).create({\n            mediaPlayerModel: mediaPlayerModel,\n            metricsModel: metricsModel,\n            errHandler: errHandler\n        });\n\n        eventBus.on(Events.BUFFERING_COMPLETED, onBufferingCompleted, instance);\n        eventBus.on(Events.DATA_UPDATE_COMPLETED, onDataUpdateCompleted, instance);\n    }\n\n    function initialize(StreamInfo, ProtectionController) {\n        streamInfo = StreamInfo;\n        protectionController = ProtectionController;\n        if (protectionController) {\n            eventBus.on(Events.KEY_ERROR, onProtectionError, instance);\n            eventBus.on(Events.SERVER_CERTIFICATE_UPDATED, onProtectionError, instance);\n            eventBus.on(Events.LICENSE_REQUEST_COMPLETE, onProtectionError, instance);\n            eventBus.on(Events.KEY_SYSTEM_SELECTED, onProtectionError, instance);\n            eventBus.on(Events.KEY_SESSION_CREATED, onProtectionError, instance);\n        }\n    }\n\n    /**\n     * Activates Stream by re-initializing some of its components\n     * @param {MediaSource} mediaSource\n     * @memberof Stream#\n     */\n    function activate(mediaSource) {\n        if (!isStreamActivated) {\n            eventBus.on(Events.CURRENT_TRACK_CHANGED, onCurrentTrackChanged, instance);\n            initializeMedia(mediaSource);\n            isStreamActivated = true;\n        }\n        //else { // TODO Check track change mode but why is this here. commented it out for now to check.\n        //    createBuffers();\n        //}\n    }\n\n    /**\n     * Partially resets some of the Stream elements\n     * @memberof Stream#\n     */\n    function deactivate() {\n        let ln = streamProcessors ? streamProcessors.length : 0;\n        for (let i = 0; i < ln; i++) {\n            streamProcessors[i].reset();\n        }\n        streamProcessors = [];\n        isStreamActivated = false;\n        isMediaInitialized = false;\n        clearEventController();\n        eventBus.off(Events.CURRENT_TRACK_CHANGED, onCurrentTrackChanged, instance);\n    }\n\n    function resetInitialSettings() {\n        deactivate();\n        streamInfo = null;\n        updateError = {};\n        isUpdating = false;\n    }\n\n    function reset() {\n\n        if (playbackController) {\n            playbackController.pause();\n            playbackController = null;\n        }\n\n        if (fragmentController) {\n            fragmentController.reset();\n            fragmentController = null;\n        }\n\n        resetInitialSettings();\n        mediaController = null;\n        abrController = null;\n        manifestUpdater = null;\n        manifestModel = null;\n        adapter = null;\n        capabilities = null;\n        log = null;\n        errHandler = null;\n\n        eventBus.off(Events.DATA_UPDATE_COMPLETED, onDataUpdateCompleted, instance);\n        eventBus.off(Events.BUFFERING_COMPLETED, onBufferingCompleted, instance);\n        eventBus.off(Events.KEY_ERROR, onProtectionError, instance);\n        eventBus.off(Events.SERVER_CERTIFICATE_UPDATED, onProtectionError, instance);\n        eventBus.off(Events.LICENSE_REQUEST_COMPLETE, onProtectionError, instance);\n        eventBus.off(Events.KEY_SYSTEM_SELECTED, onProtectionError, instance);\n        eventBus.off(Events.KEY_SESSION_CREATED, onProtectionError, instance);\n    }\n\n    function getDuration() {\n        return streamInfo ? streamInfo.duration : NaN;\n    }\n\n    function getStartTime() {\n        return streamInfo ? streamInfo.start : NaN;\n    }\n\n    function getId() {\n        return streamInfo ? streamInfo.id : NaN;\n    }\n\n    function getStreamInfo() {\n        return streamInfo;\n    }\n\n    function getEventController() {\n        return eventController;\n    }\n\n    function getFragmentController() {\n        return fragmentController;\n    }\n\n    function checkConfig() {\n        if (!abrController || !abrController.hasOwnProperty('getBitrateList') || !adapter || !adapter.hasOwnProperty('getAllMediaInfoForType') || !adapter.hasOwnProperty('getEventsFor')) {\n            throw new Error('Missing config parameter(s)');\n        }\n    }\n\n    /**\n     * @param {string} type\n     * @returns {Array}\n     * @memberof Stream#\n     */\n    function getBitrateListFor(type) {\n        checkConfig();\n        let mediaInfo = getMediaInfo(type);\n        return abrController.getBitrateList(mediaInfo);\n    }\n\n    function startEventController() {\n        if (eventController) {\n            eventController.start();\n        }\n    }\n\n    function clearEventController() {\n        if (eventController) {\n            eventController.clear();\n        }\n    }\n\n    function onProtectionError(event) {\n        if (event.error) {\n            errHandler.mediaKeySessionError(event.error);\n            log(event.error);\n            reset();\n        }\n    }\n\n    function getMimeTypeOrType(mediaInfo) {\n        return mediaInfo.type === Constants.TEXT ? mediaInfo.mimeType : mediaInfo.type;\n    }\n\n    function isMediaSupported(mediaInfo) {\n        const type = mediaInfo.type;\n        let codec,\n            msg;\n\n        if (type === Constants.MUXED && mediaInfo) {\n            msg = 'Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines';\n            log(msg);\n            errHandler.manifestError(msg, 'multiplexedrep', manifestModel.getValue());\n            return false;\n        }\n\n        if ((type === Constants.TEXT) || (type === Constants.FRAGMENTED_TEXT) || (type === Constants.EMBEDDED_TEXT)) {\n            return true;\n        }\n        codec = mediaInfo.codec;\n        log(type + ' codec: ' + codec);\n\n        if (!!mediaInfo.contentProtection && !capabilities.supportsEncryptedMedia()) {\n            errHandler.capabilityError('encryptedmedia');\n        } else if (!capabilities.supportsCodec(VideoModel(context).getInstance().getElement(), codec)) {\n            msg = type + 'Codec (' + codec + ') is not supported.';\n            errHandler.manifestError(msg, 'codec', manifestModel.getValue());\n            log(msg);\n            return false;\n        }\n\n        return true;\n    }\n\n    function onCurrentTrackChanged(e) {\n        if (e.newMediaInfo.streamInfo.id !== streamInfo.id) return;\n\n        let processor = getProcessorForMediaInfo(e.oldMediaInfo);\n        if (!processor) return;\n\n        let currentTime = playbackController.getTime();\n        log('Stream -  Process track changed at current time ' + currentTime);\n        let buffer = processor.getBuffer();\n        let mediaInfo = e.newMediaInfo;\n        let manifest = manifestModel.getValue();\n        let idx = streamProcessors.indexOf(processor);\n        let mediaSource = processor.getMediaSource();\n\n        log('Stream -  Update stream controller');\n        if (manifest.refreshManifestOnSwitchTrack) {\n            log('Stream -  Refreshing manifest for switch track');\n            trackChangedEvent = e;\n            manifestUpdater.refreshManifest();\n        } else {\n            if (mediaInfo.type !== Constants.FRAGMENTED_TEXT) {\n\n                processor.reset(true);\n                createStreamProcessor(mediaInfo, mediaSource, {\n                    buffer: buffer,\n                    replaceIdx: idx,\n                    currentTime: currentTime\n                });\n                playbackController.seek(playbackController.getTime());\n            } else {\n                processor.updateMediaInfo( mediaInfo);\n            }\n        }\n    }\n\n    function createStreamProcessor(mediaInfo, mediaSource, optionalSettings) {\n        let streamProcessor = StreamProcessor(context).create({\n            type: getMimeTypeOrType(mediaInfo),\n            mimeType: mediaInfo.mimeType,\n            timelineConverter: timelineConverter,\n            adapter: adapter,\n            manifestModel: manifestModel,\n            dashManifestModel: dashManifestModel,\n            mediaPlayerModel: mediaPlayerModel,\n            metricsModel: metricsModel,\n            dashMetrics: config.dashMetrics,\n            baseURLController: config.baseURLController,\n            stream: instance,\n            abrController: abrController,\n            domStorage: config.domStorage,\n            playbackController: playbackController,\n            mediaController: mediaController,\n            streamController: config.streamController,\n            textController: textController,\n            sourceBufferController: config.sourceBufferController,\n            errHandler: errHandler\n        });\n\n        let allMediaForType = adapter.getAllMediaInfoForType(streamInfo, mediaInfo.type);\n        streamProcessor.initialize(mediaSource);\n        abrController.updateTopQualityIndex(mediaInfo);\n\n        if (optionalSettings) {\n            streamProcessor.setBuffer(optionalSettings.buffer);\n            streamProcessor.getIndexHandler().setCurrentTime(optionalSettings.currentTime);\n            streamProcessors[optionalSettings.replaceIdx] = streamProcessor;\n        } else {\n            streamProcessors.push(streamProcessor);\n        }\n\n        if (optionalSettings && optionalSettings.ignoreMediaInfo) {\n            return;\n        }\n\n        if ((mediaInfo.type === Constants.TEXT || mediaInfo.type === Constants.FRAGMENTED_TEXT)) {\n            let idx;\n            for (let i = 0; i < allMediaForType.length; i++) {\n                if (allMediaForType[i].index === mediaInfo.index) {\n                    idx = i;\n                }\n                streamProcessor.updateMediaInfo(allMediaForType[i]); //creates text tracks for all adaptations in one stream processor\n            }\n            if (mediaInfo.type === Constants.FRAGMENTED_TEXT) {\n                streamProcessor.updateMediaInfo(allMediaForType[idx]); //sets the initial media info\n            }\n        } else {\n            streamProcessor.updateMediaInfo(mediaInfo);\n        }\n    }\n\n    function initializeMediaForType(type, mediaSource) {\n        const allMediaForType = adapter.getAllMediaInfoForType(streamInfo, type);\n\n        let mediaInfo = null;\n        let initialMediaInfo;\n\n        if (!allMediaForType || allMediaForType.length === 0) {\n            log('No ' + type + ' data.');\n            return;\n        }\n\n        for (let i = 0, ln = allMediaForType.length; i < ln; i++) {\n            mediaInfo = allMediaForType[i];\n\n            if (type === Constants.EMBEDDED_TEXT) {\n                textController.addEmbeddedTrack(mediaInfo);\n            } else {\n                if (!isMediaSupported(mediaInfo)) {\n                    continue;\n                }\n                if (mediaController.isMultiTrackSupportedByType(mediaInfo.type)) {\n                    mediaController.addTrack(mediaInfo, streamInfo);\n                }\n            }\n        }\n\n        if (type === Constants.EMBEDDED_TEXT || mediaController.getTracksFor(type, streamInfo).length === 0) {\n            return;\n        }\n\n        mediaController.checkInitialMediaSettingsForType(type, streamInfo);\n        initialMediaInfo = mediaController.getCurrentTrackFor(type, streamInfo);\n\n        // TODO : How to tell index handler live/duration?\n        // TODO : Pass to controller and then pass to each method on handler?\n\n        createStreamProcessor(initialMediaInfo, mediaSource);\n    }\n\n    function initializeMedia(mediaSource) {\n        checkConfig();\n        let events;\n\n        eventController = EventController(context).create();\n        eventController.initialize();\n        eventController.setConfig({\n            manifestModel: manifestModel,\n            manifestUpdater: manifestUpdater,\n            playbackController: playbackController\n        });\n        events = adapter.getEventsFor(streamInfo);\n        eventController.addInlineEvents(events);\n\n        isUpdating = true;\n        initializeMediaForType(Constants.VIDEO, mediaSource);\n        initializeMediaForType(Constants.AUDIO, mediaSource);\n        initializeMediaForType(Constants.TEXT, mediaSource);\n        initializeMediaForType(Constants.FRAGMENTED_TEXT, mediaSource);\n        initializeMediaForType(Constants.EMBEDDED_TEXT, mediaSource);\n        initializeMediaForType(Constants.MUXED, mediaSource);\n\n        createBuffers();\n\n        //TODO. Consider initialization of TextSourceBuffer here if embeddedText, but no sideloadedText.\n\n        isMediaInitialized = true;\n        isUpdating = false;\n\n        if (streamProcessors.length === 0) {\n            let msg = 'No streams to play.';\n            errHandler.manifestError(msg, 'nostreams', manifestModel.getValue());\n            log(msg);\n        } else {\n            //log(\"Playback initialized!\");\n            checkIfInitializationCompleted();\n        }\n    }\n\n    function checkIfInitializationCompleted() {\n        const ln = streamProcessors.length;\n        const hasError = !!updateError.audio || !!updateError.video;\n        let error = hasError ? new Error(DATA_UPDATE_FAILED_ERROR_CODE, 'Data update failed', null) : null;\n\n        for (let i = 0; i < ln; i++) {\n            if (streamProcessors[i].isUpdating() || isUpdating) {\n                return;\n            }\n        }\n\n        if (!isMediaInitialized) {\n            return;\n        }\n        if (protectionController) {\n            protectionController.initialize(manifestModel.getValue(), getMediaInfo(Constants.AUDIO), getMediaInfo(Constants.VIDEO));\n        }\n        eventBus.trigger(Events.STREAM_INITIALIZED, {\n            streamInfo: streamInfo,\n            error: error\n        });\n    }\n\n    function getMediaInfo(type) {\n        const ln = streamProcessors.length;\n        let mediaCtrl = null;\n\n        for (let i = 0; i < ln; i++) {\n            mediaCtrl = streamProcessors[i];\n\n            if (mediaCtrl.getType() === type) {\n                return mediaCtrl.getMediaInfo();\n            }\n        }\n\n        return null;\n    }\n\n    function createBuffers() {\n        for (let i = 0, ln = streamProcessors.length; i < ln; i++) {\n            streamProcessors[i].createBuffer();\n        }\n    }\n\n    function onBufferingCompleted(e) {\n        if (e.streamInfo !== streamInfo) {\n            return;\n        }\n\n        let processors = getProcessors();\n        const ln = processors.length;\n\n        // if there is at least one buffer controller that has not completed buffering yet do nothing\n        for (let i = 0; i < ln; i++) {\n            if (!processors[i].isBufferingCompleted()) {\n                return;\n            }\n        }\n\n        eventBus.trigger(Events.STREAM_BUFFERING_COMPLETED, {\n            streamInfo: streamInfo\n        });\n    }\n\n    function onDataUpdateCompleted(e) {\n        let sp = e.sender.getStreamProcessor();\n\n        if (sp.getStreamInfo() !== streamInfo) {\n            return;\n        }\n\n        updateError[sp.getType()] = e.error;\n        checkIfInitializationCompleted();\n    }\n\n    function getProcessorForMediaInfo(mediaInfo) {\n        if (!mediaInfo) {\n            return false;\n        }\n\n        let processors = getProcessors();\n\n        return processors.filter(function (processor) {\n            return (processor.getType() === mediaInfo.type);\n        })[0];\n    }\n\n    function getProcessors() {\n        const ln = streamProcessors.length;\n        let arr = [];\n\n        let type,\n            controller;\n\n        for (let i = 0; i < ln; i++) {\n            controller = streamProcessors[i];\n            type = controller.getType();\n\n            if (type === Constants.AUDIO || type === Constants.VIDEO || type === Constants.FRAGMENTED_TEXT) {\n                arr.push(controller);\n            }\n        }\n\n        return arr;\n    }\n\n    function updateData(updatedStreamInfo) {\n\n        log('Manifest updated... updating data system wide.');\n\n        isStreamActivated = false;\n        isUpdating = true;\n        streamInfo = updatedStreamInfo;\n\n        if (eventController) {\n            let events = adapter.getEventsFor(streamInfo);\n            eventController.addInlineEvents(events);\n        }\n\n        for (let i = 0, ln = streamProcessors.length; i < ln; i++) {\n            let streamProcessor = streamProcessors[i];\n            let mediaInfo = adapter.getMediaInfoForType(streamInfo, streamProcessor.getType());\n            abrController.updateTopQualityIndex(mediaInfo);\n            streamProcessor.updateMediaInfo(mediaInfo);\n        }\n\n        if (trackChangedEvent) {\n            let mediaInfo = trackChangedEvent.newMediaInfo;\n            if (mediaInfo.type !== 'fragmentedText') {\n                let processor = getProcessorForMediaInfo(trackChangedEvent.oldMediaInfo);\n                if (!processor) return;\n                processor.switchTrackAsked();\n            }\n        }\n\n        isUpdating = false;\n        checkIfInitializationCompleted();\n    }\n\n    instance = {\n        initialize: initialize,\n        activate: activate,\n        deactivate: deactivate,\n        getDuration: getDuration,\n        getStartTime: getStartTime,\n        getId: getId,\n        getStreamInfo: getStreamInfo,\n        getFragmentController: getFragmentController,\n        getEventController: getEventController,\n        getBitrateListFor: getBitrateListFor,\n        startEventController: startEventController,\n        updateData: updateData,\n        reset: reset,\n        getProcessors: getProcessors\n    };\n\n    setup();\n    return instance;\n}\n\nStream.__dashjs_factory_name = 'Stream';\nexport default FactoryMaker.getClassFactory(Stream);\n"]}