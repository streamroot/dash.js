{"version":3,"sources":["../../../../../src/streaming/models/MetricsModel.js"],"names":[],"mappings":"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","file":"MetricsModel.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport Constants from '../constants/Constants';\nimport MetricsConstants from '../constants/MetricsConstants';\nimport MetricsList from '../vo/MetricsList';\nimport TCPConnection from '../vo/metrics/TCPConnection';\nimport {HTTPRequest, HTTPRequestTrace} from '../vo/metrics/HTTPRequest';\nimport TrackSwitch from '../vo/metrics/RepresentationSwitch';\nimport BufferLevel from '../vo/metrics/BufferLevel';\nimport BufferState from '../vo/metrics/BufferState';\nimport DVRInfo from '../vo/metrics/DVRInfo';\nimport DroppedFrames from '../vo/metrics/DroppedFrames';\nimport {ManifestUpdate, ManifestUpdateStreamInfo, ManifestUpdateTrackInfo} from '../vo/metrics/ManifestUpdate';\nimport SchedulingInfo from '../vo/metrics/SchedulingInfo';\nimport EventBus from '../../core/EventBus';\nimport RequestsQueue from '../vo/metrics/RequestsQueue';\nimport Events from '../../core/events/Events';\nimport FactoryMaker from '../../core/FactoryMaker';\n\nfunction MetricsModel() {\n\n    const MAXIMUM_LIST_DEPTH = 1000;\n\n    let context = this.context;\n    let eventBus = EventBus(context).getInstance();\n\n    let instance,\n        adapter,\n        streamMetrics;\n\n    function setup() {\n        streamMetrics = {};\n    }\n\n    function setConfig(config) {\n        if (!config) return;\n\n        if (config.adapter) {\n            adapter = config.adapter;\n        }\n    }\n\n    function metricsChanged() {\n        eventBus.trigger(Events.METRICS_CHANGED);\n    }\n\n    function metricChanged(mediaType) {\n        eventBus.trigger(Events.METRIC_CHANGED, {mediaType: mediaType});\n        metricsChanged();\n    }\n\n    function metricUpdated(mediaType, metricType, vo) {\n        eventBus.trigger(Events.METRIC_UPDATED, {mediaType: mediaType, metric: metricType, value: vo});\n        metricChanged(mediaType);\n    }\n\n    function metricAdded(mediaType, metricType, vo) {\n        eventBus.trigger(Events.METRIC_ADDED, {mediaType: mediaType, metric: metricType, value: vo});\n        metricChanged(mediaType);\n    }\n\n    function clearCurrentMetricsForType(type) {\n        delete streamMetrics[type];\n        metricChanged(type);\n    }\n\n    function clearAllCurrentMetrics() {\n        streamMetrics = {};\n        metricsChanged();\n    }\n\n    function getReadOnlyMetricsFor(type) {\n        if (streamMetrics.hasOwnProperty(type)) {\n            return streamMetrics[type];\n        }\n\n        return null;\n    }\n\n    function getMetricsFor(type) {\n        let metrics;\n\n        if (streamMetrics.hasOwnProperty(type)) {\n            metrics = streamMetrics[type];\n        } else {\n            metrics = new MetricsList();\n            streamMetrics[type] = metrics;\n        }\n\n        return metrics;\n    }\n\n    function pushMetrics(type, list, value) {\n        let metrics = getMetricsFor(type);\n        metrics[list].push(value);\n        if ( metrics[list].length > MAXIMUM_LIST_DEPTH ) {\n            metrics[list].shift();\n        }\n    }\n\n    function addTcpConnection(mediaType, tcpid, dest, topen, tclose, tconnect) {\n        let vo = new TCPConnection();\n\n        vo.tcpid = tcpid;\n        vo.dest = dest;\n        vo.topen = topen;\n        vo.tclose = tclose;\n        vo.tconnect = tconnect;\n\n        pushAndNotify(mediaType, MetricsConstants.TCP_CONNECTION, vo);\n\n        return vo;\n    }\n\n    function appendHttpTrace(httpRequest, s, d, b) {\n        let vo = new HTTPRequestTrace();\n\n        vo.s = s;\n        vo.d = d;\n        vo.b = b;\n\n        httpRequest.trace.push(vo);\n\n        if (!httpRequest.interval) {\n            httpRequest.interval = 0;\n        }\n\n        httpRequest.interval += d;\n\n        return vo;\n    }\n\n    function addHttpRequest(mediaType, tcpid, type, url, actualurl, serviceLocation, range, trequest, tresponse, tfinish, responsecode, mediaduration, responseHeaders, traces) {\n        let vo = new HTTPRequest();\n\n        // ISO 23009-1 D.4.3 NOTE 2:\n        // All entries for a given object will have the same URL and range\n        // and so can easily be correlated. If there were redirects or\n        // failures there will be one entry for each redirect/failure.\n        // The redirect-to URL or alternative url (where multiple have been\n        // provided in the MPD) will appear as the actualurl of the next\n        // entry with the same url value.\n        if (actualurl && (actualurl !== url)) {\n\n            // given the above, add an entry for the original request\n            addHttpRequest(\n                mediaType,\n                null,\n                type,\n                url,\n                null,\n                null,\n                range,\n                trequest,\n                null, // unknown\n                null, // unknown\n                null, // unknown, probably a 302\n                mediaduration,\n                null,\n                null\n            );\n\n            vo.actualurl = actualurl;\n        }\n\n        vo.tcpid = tcpid;\n        vo.type = type;\n        vo.url = url;\n        vo.range = range;\n        vo.trequest = trequest;\n        vo.tresponse = tresponse;\n        vo.responsecode = responsecode;\n\n        vo._tfinish = tfinish;\n        vo._stream = mediaType;\n        vo._mediaduration = mediaduration;\n        vo._responseHeaders = responseHeaders;\n        vo._serviceLocation = serviceLocation;\n\n        if (traces) {\n            traces.forEach(trace => {\n                appendHttpTrace(vo, trace.s, trace.d, trace.b);\n            });\n        } else {\n            // The interval and trace shall be absent for redirect and failure records.\n            delete vo.interval;\n            delete vo.trace;\n        }\n\n        pushAndNotify(mediaType, MetricsConstants.HTTP_REQUEST, vo);\n\n        return vo;\n    }\n\n    function addRepresentationSwitch(mediaType, t, mt, to, lto) {\n        let vo = new TrackSwitch();\n\n        vo.t = t;\n        vo.mt = mt;\n        vo.to = to;\n\n        if (lto) {\n            vo.lto = lto;\n        } else {\n            delete vo.lto;\n        }\n\n        pushAndNotify(mediaType, MetricsConstants.TRACK_SWITCH, vo);\n\n        return vo;\n    }\n\n    function pushAndNotify(mediaType, metricType, metricObject) {\n        pushMetrics(mediaType, metricType, metricObject);\n        metricAdded(mediaType, metricType, metricObject);\n    }\n\n    function addBufferLevel(mediaType, t, level) {\n        let vo = new BufferLevel();\n        vo.t = t;\n        vo.level = level;\n\n        pushAndNotify(mediaType, MetricsConstants.BUFFER_LEVEL, vo);\n\n        return vo;\n    }\n\n    function addBufferState(mediaType, state, target) {\n        let vo = new BufferState();\n        vo.target = target;\n        vo.state = state;\n\n        pushAndNotify(mediaType, MetricsConstants.BUFFER_STATE, vo);\n\n        return vo;\n    }\n\n    function addDVRInfo(mediaType, currentTime, mpd, range) {\n        let vo = new DVRInfo();\n        vo.time = currentTime ;\n        vo.range = range;\n        vo.manifestInfo = mpd;\n\n        pushAndNotify(mediaType, MetricsConstants.DVR_INFO, vo);\n\n        return vo;\n    }\n\n    function addDroppedFrames(mediaType, quality) {\n        let vo = new DroppedFrames();\n        let list = getMetricsFor(mediaType).DroppedFrames;\n\n        vo.time = quality.creationTime;\n        vo.droppedFrames = quality.droppedVideoFrames;\n\n        if (list.length > 0 && list[list.length - 1] == vo) {\n            return list[list.length - 1];\n        }\n\n        pushAndNotify(mediaType, MetricsConstants.DROPPED_FRAMES, vo);\n\n        return vo;\n    }\n\n    function addSchedulingInfo(mediaType, t, type, startTime, availabilityStartTime, duration, quality, range, state) {\n        let vo = new SchedulingInfo();\n\n        vo.mediaType = mediaType;\n        vo.t = t;\n\n        vo.type = type;\n        vo.startTime = startTime;\n        vo.availabilityStartTime = availabilityStartTime;\n        vo.duration = duration;\n        vo.quality = quality;\n        vo.range = range;\n\n        vo.state = state;\n\n        pushAndNotify(mediaType, MetricsConstants.SCHEDULING_INFO, vo);\n\n        return vo;\n    }\n\n    function addRequestsQueue(mediaType, loadingRequests, executedRequests) {\n        let vo = new RequestsQueue();\n        vo.loadingRequests = loadingRequests;\n        vo.executedRequests = executedRequests;\n\n        getMetricsFor(mediaType).RequestsQueue = vo;\n        metricAdded(mediaType, MetricsConstants.REQUESTS_QUEUE, vo);\n    }\n\n    function addManifestUpdate(mediaType, type, requestTime, fetchTime, availabilityStartTime, presentationStartTime, clientTimeOffset, currentTime, buffered, latency) {\n        let vo = new ManifestUpdate();\n\n        vo.mediaType = mediaType;\n        vo.type = type;\n        vo.requestTime = requestTime; // when this manifest update was requested\n        vo.fetchTime = fetchTime; // when this manifest update was received\n        vo.availabilityStartTime = availabilityStartTime;\n        vo.presentationStartTime = presentationStartTime; // the seek point (liveEdge for dynamic, Stream[0].startTime for static)\n        vo.clientTimeOffset = clientTimeOffset; // the calculated difference between the server and client wall clock time\n        vo.currentTime = currentTime; // actual element.currentTime\n        vo.buffered = buffered; // actual element.ranges\n        vo.latency = latency; // (static is fixed value of zero. dynamic should be ((Now-@availabilityStartTime) - currentTime)\n\n        pushMetrics(Constants.STREAM, MetricsConstants.MANIFEST_UPDATE, vo);\n        metricAdded(mediaType, MetricsConstants.MANIFEST_UPDATE, vo);\n\n        return vo;\n    }\n\n    function updateManifestUpdateInfo(manifestUpdate, updatedFields) {\n        if (manifestUpdate) {\n            for (let field in updatedFields) {\n                manifestUpdate[field] = updatedFields[field];\n            }\n\n            metricUpdated(manifestUpdate.mediaType, MetricsConstants.MANIFEST_UPDATE, manifestUpdate);\n        }\n    }\n\n    function addManifestUpdateStreamInfo(manifestUpdate, id, index, start, duration) {\n        if (manifestUpdate) {\n            let vo = new ManifestUpdateStreamInfo();\n\n            vo.id = id;\n            vo.index = index;\n            vo.start = start;\n            vo.duration = duration;\n\n            manifestUpdate.streamInfo.push(vo);\n            metricUpdated(manifestUpdate.mediaType, MetricsConstants.MANIFEST_UPDATE_STREAM_INFO, manifestUpdate);\n\n            return vo;\n        }\n        return null;\n    }\n\n    function addManifestUpdateRepresentationInfo(manifestUpdate, id, index, streamIndex, mediaType, presentationTimeOffset, startNumber, fragmentInfoType) {\n        if (manifestUpdate) {\n            let vo = new ManifestUpdateTrackInfo();\n\n            vo.id = id;\n            vo.index = index;\n            vo.streamIndex = streamIndex;\n            vo.mediaType = mediaType;\n            vo.startNumber = startNumber;\n            vo.fragmentInfoType = fragmentInfoType;\n            vo.presentationTimeOffset = presentationTimeOffset;\n\n            manifestUpdate.trackInfo.push(vo);\n            metricUpdated(manifestUpdate.mediaType, MetricsConstants.MANIFEST_UPDATE_TRACK_INFO, manifestUpdate);\n\n            return vo;\n        }\n        return null;\n    }\n\n    function addPlayList(vo) {\n        let type = Constants.STREAM;\n\n        if (vo.trace && Array.isArray(vo.trace)) {\n            vo.trace.forEach(trace => {\n                if (trace.hasOwnProperty('subreplevel') && !trace.subreplevel) {\n                    delete trace.subreplevel;\n                }\n            });\n        } else {\n            delete vo.trace;\n        }\n\n        pushAndNotify(type, MetricsConstants.PLAY_LIST, vo);\n\n        return vo;\n    }\n\n    function addDVBErrors(vo) {\n        let type = Constants.STREAM;\n\n        pushAndNotify(type, MetricsConstants.DVB_ERRORS, vo);\n\n        return vo;\n    }\n\n    instance = {\n        clearCurrentMetricsForType: clearCurrentMetricsForType,\n        clearAllCurrentMetrics: clearAllCurrentMetrics,\n        getReadOnlyMetricsFor: getReadOnlyMetricsFor,\n        getMetricsFor: getMetricsFor,\n        addTcpConnection: addTcpConnection,\n        addHttpRequest: addHttpRequest,\n        addRepresentationSwitch: addRepresentationSwitch,\n        addBufferLevel: addBufferLevel,\n        addBufferState: addBufferState,\n        addDVRInfo: addDVRInfo,\n        addDroppedFrames: addDroppedFrames,\n        addSchedulingInfo: addSchedulingInfo,\n        addRequestsQueue: addRequestsQueue,\n        addManifestUpdate: addManifestUpdate,\n        updateManifestUpdateInfo: updateManifestUpdateInfo,\n        addManifestUpdateStreamInfo: addManifestUpdateStreamInfo,\n        addManifestUpdateRepresentationInfo: addManifestUpdateRepresentationInfo,\n        addPlayList: addPlayList,\n        addDVBErrors: addDVBErrors,\n        setConfig: setConfig\n    };\n\n    setup();\n    return instance;\n}\n\nMetricsModel.__dashjs_factory_name = 'MetricsModel';\nexport default FactoryMaker.getSingletonFactory(MetricsModel);\n"]}