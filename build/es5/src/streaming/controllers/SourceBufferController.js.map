{"version":3,"sources":["../../../../../src/streaming/controllers/SourceBufferController.js"],"names":[],"mappings":"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","file":"SourceBufferController.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport TextSourceBuffer from '../TextSourceBuffer';\nimport MediaController from './MediaController';\nimport DashAdapter from '../../dash/DashAdapter';\nimport ErrorHandler from '../utils/ErrorHandler';\nimport StreamController from './StreamController';\nimport TextTracks from '../TextTracks';\nimport VTTParser from '../utils/VTTParser';\nimport TTMLParser from '../utils/TTMLParser';\nimport VideoModel from '../models/VideoModel';\nimport Error from '../vo/Error';\nimport EventBus from '../../core/EventBus';\nimport Events from '../../core/events/Events';\nimport FactoryMaker from '../../core/FactoryMaker';\n\n\nconst QUOTA_EXCEEDED_ERROR_CODE = 22;\n\nfunction SourceBufferController() {\n\n    let context = this.context;\n    let eventBus = EventBus(context).getInstance();\n\n    let instance,\n        dashManifestModel;\n\n    function createSourceBuffer(mediaSource, mediaInfo) {\n\n        var codec = mediaInfo.codec;\n        var buffer = null;\n\n        try {\n            // Safari claims to support anything starting 'application/mp4'.\n            // it definitely doesn't understand 'application/mp4;codecs=\"stpp\"'\n            // - currently no browser does, so check for it and use our own\n            // implementation. The same is true for codecs=\"wvtt\".\n            if (codec.match(/application\\/mp4;\\s*codecs=\"(stpp|wvtt).*\"/i)) {\n                throw new Error('not really supported');\n            }\n\n            buffer = mediaSource.addSourceBuffer(codec);\n\n        } catch (ex) {\n            // Note that in the following, the quotes are open to allow for extra text after stpp and wvtt\n            if ((mediaInfo.isText) || (codec.indexOf('codecs=\"stpp') !== -1) ||  (codec.indexOf('codecs=\"wvtt') !== -1) ) {\n                buffer = TextSourceBuffer(context).getInstance();\n                buffer.setConfig({\n                    errHandler: ErrorHandler(context).getInstance(),\n                    adapter: DashAdapter(context).getInstance(),\n                    dashManifestModel: dashManifestModel,\n                    mediaController: MediaController(context).getInstance(),\n                    videoModel: VideoModel(context).getInstance(),\n                    streamController: StreamController(context).getInstance(),\n                    textTracks: TextTracks(context).getInstance(),\n                    VTTParser: VTTParser(context).getInstance(),\n                    TTMLParser: TTMLParser(context).getInstance()\n\n                });\n            } else {\n                throw ex;\n            }\n        }\n\n        return buffer;\n    }\n\n    function removeSourceBuffer(mediaSource, buffer) {\n        try {\n            mediaSource.removeSourceBuffer(buffer);\n        } catch (ex) {\n        }\n    }\n\n    function getBufferRange(buffer, time, tolerance) {\n        var ranges = null;\n        var start = 0;\n        var end = 0;\n        var firstStart = null;\n        var lastEnd = null;\n        var gap = 0;\n\n        var len,\n            i;\n\n        var toler = (tolerance || 0.15);\n\n        try {\n            ranges = buffer.buffered;\n        } catch (ex) {\n            return null;\n        }\n\n        if (ranges !== null && ranges !== undefined) {\n            for (i = 0, len = ranges.length; i < len; i++) {\n                start = ranges.start(i);\n                end = ranges.end(i);\n                if (firstStart === null) {\n                    gap = Math.abs(start - time);\n                    if (time >= start && time < end) {\n                        // start the range\n                        firstStart = start;\n                        lastEnd = end;\n                    } else if (gap <= toler) {\n                        // start the range even though the buffer does not contain time 0\n                        firstStart = start;\n                        lastEnd = end;\n                    }\n                } else {\n                    gap = start - lastEnd;\n                    if (gap <= toler) {\n                        // the discontinuity is smaller than the tolerance, combine the ranges\n                        lastEnd = end;\n                    } else {\n                        break;\n                    }\n                }\n            }\n\n            if (firstStart !== null) {\n                return {start: firstStart, end: lastEnd};\n            }\n        }\n\n        return null;\n    }\n\n    function getAllRanges(buffer) {\n        var ranges = null;\n\n        try {\n            ranges = buffer.buffered;\n            return ranges;\n        } catch (ex) {\n            return null;\n        }\n    }\n\n    function getTotalBufferedTime(buffer) {\n        var ranges = getAllRanges(buffer);\n        var totalBufferedTime = 0;\n        var ln,\n            i;\n\n        if (!ranges) return totalBufferedTime;\n\n        for (i = 0, ln = ranges.length; i < ln; i++) {\n            totalBufferedTime += ranges.end(i) - ranges.start(i);\n        }\n\n        return totalBufferedTime;\n    }\n\n    function getBufferLength(buffer, time, tolerance) {\n\n        var range,\n            length;\n\n        range = getBufferRange(buffer, time, tolerance);\n\n        if (range === null) {\n            length = 0;\n        } else {\n            length = range.end - time;\n        }\n\n        return length;\n    }\n\n    function getRangeDifference(currentRanges, buffer) {\n        if (!buffer) return null;\n\n        //TODO we may need to look for a more elegant and robust method\n        // The logic below checks that is the difference between currentRanges and actual SourceBuffer ranges\n\n        var newRanges = getAllRanges(buffer);\n        var newStart,\n            newEnd,\n            equalStart,\n            equalEnd,\n            currentRange,\n            nextCurrentRange,\n            nextNewRange,\n            hasRange,\n            diff;\n\n        if (!newRanges) return null;\n\n        for (var i = 0, ln = newRanges.length; i < ln; i++) {\n            hasRange = currentRanges.length > i;\n            currentRange = hasRange ? {start: currentRanges.start(i), end: currentRanges.end(i)} : null;\n            newStart = newRanges.start(i);\n            newEnd = newRanges.end(i);\n\n            // if there is no range with the same index it means that a new range has been added. This range is\n            // the difference we are looking for\n            // Example\n            // current ranges\n            // 0|---range1---|4  8|--range2--|12\n            // new ranges\n            // 0|---range1---|4| 8|--range2--|12  16|--range3--|20\n\n            if (!currentRange) {\n                diff = {start: newStart, end: newEnd};\n                return diff;\n            }\n\n            equalStart = currentRange.start === newStart;\n            equalEnd = currentRange.end === newEnd;\n\n            // if ranges are equal do nothing here and go the next ranges\n            if (equalStart && equalEnd) continue;\n\n            // start or/and end of the range has been changed\n            if (equalStart) {\n                diff = {start: currentRange.end, end: newEnd};\n            } else if (equalEnd) {\n                diff = {start: newStart, end: currentRange.start};\n            } else {\n                // new range has been added before the current one\n                diff = {start: newStart, end: newEnd};\n                return diff;\n            }\n\n            // if there is next current range but no next new range (it it is not equal the next current range) it means\n            // that the ranges have been merged\n            // Example 1\n            // current ranges\n            // 0|---range1---|4  8|--range2--|12  16|---range3---|\n            // new ranges\n            // 0|-----------range1-----------|12  16|---range3--|\n            nextCurrentRange = currentRanges.length > (i + 1) ? {start: currentRanges.start(i + 1), end: currentRanges.end(i + 1)} : null;\n            nextNewRange = (i + 1) < ln ? {start: newRanges.start(i + 1), end: newRanges.end(i + 1)} : null;\n\n            if (nextCurrentRange && (!nextNewRange || (nextNewRange.start !== nextCurrentRange.start || nextNewRange.end !== nextCurrentRange.end))) {\n                diff.end = nextCurrentRange.start;\n            }\n\n            return diff;\n        }\n\n        return null;\n    }\n\n    function append(buffer, chunk) {\n        var bytes = chunk.bytes;\n        var appendMethod = ('append' in buffer) ? 'append' : (('appendBuffer' in buffer) ? 'appendBuffer' : null);\n        // our user-defined sourcebuffer-like object has Object as its\n        // prototype whereas built-in SourceBuffers will have something\n        // more sensible. do not pass chunk to built-in append.\n        var acceptsChunk = Object.prototype.toString.call(buffer).slice(8, -1) === 'Object';\n\n        if (!appendMethod) return;\n\n        try {\n            waitForUpdateEnd(buffer, function () {\n                if (acceptsChunk) {\n                    // chunk.start is used in calculations by TextSourceBuffer\n                    buffer[appendMethod](bytes, chunk);\n                } else {\n                    buffer[appendMethod](bytes);\n                }\n                // updating is in progress, we should wait for it to complete before signaling that this operation is done\n                waitForUpdateEnd(buffer, function () {\n                    eventBus.trigger(Events.SOURCEBUFFER_APPEND_COMPLETED, {buffer: buffer, bytes: bytes});\n                });\n            });\n        } catch (err) {\n            eventBus.trigger(Events.SOURCEBUFFER_APPEND_COMPLETED, {buffer: buffer, bytes: bytes, error: new Error(err.code, err.message, null)});\n        }\n    }\n\n    function remove(buffer, start, end, mediaSource) {\n\n        try {\n            // make sure that the given time range is correct. Otherwise we will get InvalidAccessError\n            waitForUpdateEnd(buffer, function () {\n                if ((start >= 0) && (end > start) && (mediaSource.readyState !== 'ended')) {\n                    buffer.remove(start, end);\n                }\n                // updating is in progress, we should wait for it to complete before signaling that this operation is done\n                waitForUpdateEnd(buffer, function () {\n                    eventBus.trigger(Events.SOURCEBUFFER_REMOVE_COMPLETED, {buffer: buffer, from: start, to: end});\n                });\n            });\n        } catch (err) {\n            eventBus.trigger(Events.SOURCEBUFFER_REMOVE_COMPLETED, {buffer: buffer, from: start, to: end, error: new Error(err.code, err.message, null)});\n        }\n    }\n\n    function abort(mediaSource, buffer) {\n        try {\n            if (mediaSource.readyState === 'open') {\n                buffer.abort();\n            } else if (buffer.setTextTrack && mediaSource.readyState === 'ended') {\n                buffer.abort(); //The cues need to be removed from the TextSourceBuffer via a call to abort()\n            }\n        } catch (ex) {\n        }\n    }\n\n    function setConfig(config) {\n        if (!config) return;\n\n        if (config.dashManifestModel) {\n            dashManifestModel = config.dashManifestModel;\n        }\n    }\n\n    function waitForUpdateEnd(buffer, callback) {\n        var intervalId;\n        var CHECK_INTERVAL = 50;\n\n        var checkIsUpdateEnded = function () {\n            // if updating is still in progress do nothing and wait for the next check again.\n            if (buffer.updating) return;\n            // updating is completed, now we can stop checking and resolve the promise\n            clearInterval(intervalId);\n            callback();\n        };\n\n        var updateEndHandler = function () {\n            if (buffer.updating) return;\n\n            buffer.removeEventListener('updateend', updateEndHandler, false);\n            callback();\n        };\n\n        if (!buffer.updating) {\n            callback();\n            return;\n        }\n\n        // use updateend event if possible\n        if (typeof buffer.addEventListener === 'function') {\n            try {\n                buffer.addEventListener('updateend', updateEndHandler, false);\n            } catch (err) {\n                // use setInterval to periodically check if updating has been completed\n                intervalId = setInterval(checkIsUpdateEnded, CHECK_INTERVAL);\n            }\n        } else {\n            // use setInterval to periodically check if updating has been completed\n            intervalId = setInterval(checkIsUpdateEnded, CHECK_INTERVAL);\n        }\n    }\n\n    instance = {\n        append: append,\n        remove: remove,\n        abort: abort,\n        createSourceBuffer: createSourceBuffer,\n        removeSourceBuffer: removeSourceBuffer,\n        getBufferRange: getBufferRange,\n        getAllRanges: getAllRanges,\n        getTotalBufferedTime: getTotalBufferedTime,\n        getBufferLength: getBufferLength,\n        getRangeDifference: getRangeDifference,\n        setConfig: setConfig\n    };\n\n    return instance;\n}\n\nSourceBufferController.__dashjs_factory_name = 'SourceBufferController';\nlet factory = FactoryMaker.getSingletonFactory(SourceBufferController);\nfactory.QUOTA_EXCEEDED_ERROR_CODE = QUOTA_EXCEEDED_ERROR_CODE;\nexport default factory;"]}