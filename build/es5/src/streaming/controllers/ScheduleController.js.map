{"version":3,"sources":["../../../../../src/streaming/controllers/ScheduleController.js"],"names":[],"mappings":"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","file":"ScheduleController.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport {PlayListTrace} from '../vo/metrics/PlayList';\nimport PlaybackController from './PlaybackController';\nimport AbrController from './AbrController';\nimport BufferController from './BufferController';\nimport MediaController from './MediaController';\nimport BufferLevelRule from '../rules/scheduling/BufferLevelRule';\nimport NextFragmentRequestRule from '../rules/scheduling/NextFragmentRequestRule';\nimport TextSourceBuffer from '../TextSourceBuffer';\nimport MetricsModel from '../models/MetricsModel';\nimport FragmentModel from '../models/FragmentModel';\nimport DashMetrics from '../../dash/DashMetrics';\nimport DashAdapter from '../../dash/DashAdapter';\nimport SourceBufferController from '../controllers/SourceBufferController';\nimport LiveEdgeFinder from '../utils/LiveEdgeFinder';\nimport EventBus from '../../core/EventBus';\nimport Events from '../../core/events/Events';\nimport FactoryMaker from '../../core/FactoryMaker';\nimport StreamController from '../controllers/StreamController';\nimport Debug from '../../core/Debug';\n\nfunction ScheduleController(config) {\n\n    const context = this.context;\n    const log = Debug(context).getInstance().log;\n    const eventBus = EventBus(context).getInstance();\n    const metricsModel = config.metricsModel;\n    const manifestModel = config.manifestModel;\n    const adapter = config.adapter;\n    const dashMetrics = config.dashMetrics;\n    const dashManifestModel = config.dashManifestModel;\n    const timelineConverter = config.timelineConverter;\n    const mediaPlayerModel = config.mediaPlayerModel;\n\n    let instance,\n        type,\n        fragmentModel,\n        isDynamic,\n        currentRepresentationInfo,\n        initialRequest,\n        isStopped,\n        playListMetrics,\n        playListTraceMetrics,\n        playListTraceMetricsClosed,\n        isFragmentProcessingInProgress,\n        timeToLoadDelay,\n        scheduleTimeout,\n        seekTarget,\n        playbackController,\n        mediaController,\n        abrController,\n        streamProcessor,\n        streamController,\n        fragmentController,\n        bufferController,\n        bufferLevelRule,\n        nextFragmentRequestRule,\n        scheduleWhilePaused,\n        lastQualityIndex,\n        topQualityIndex,\n        lastInitQuality,\n        replaceRequestArray;\n\n    function setup() {\n        initialRequest = true;\n        lastInitQuality = NaN;\n        lastQualityIndex = NaN;\n        topQualityIndex = {};\n        replaceRequestArray = [];\n        isStopped = false;\n        playListMetrics = null;\n        playListTraceMetrics = null;\n        playListTraceMetricsClosed = true;\n        isFragmentProcessingInProgress = false;\n        timeToLoadDelay = 0;\n        seekTarget = NaN;\n    }\n\n    function initialize(Type, StreamProcessor) {\n        type = Type;\n        streamProcessor = StreamProcessor;\n        playbackController = PlaybackController(context).getInstance();\n        mediaController = MediaController(context).getInstance();\n        abrController = AbrController(context).getInstance();\n        streamController = StreamController(context).getInstance();\n        fragmentController = streamProcessor.getFragmentController();\n        bufferController = streamProcessor.getBufferController();\n        fragmentModel = fragmentController.getModel(type);\n        fragmentModel.setScheduleController(this);\n        isDynamic = streamProcessor.isDynamic();\n        scheduleWhilePaused = mediaPlayerModel.getScheduleWhilePaused();\n\n        bufferLevelRule = BufferLevelRule(context).create({\n            dashMetrics: DashMetrics(context).getInstance(),\n            metricsModel: MetricsModel(context).getInstance(),\n            textSourceBuffer: TextSourceBuffer(context).getInstance()\n        });\n\n        nextFragmentRequestRule = NextFragmentRequestRule(context).create({\n            adapter: DashAdapter(context).getInstance(),\n            sourceBufferController: SourceBufferController(context).getInstance(),\n            textSourceBuffer: TextSourceBuffer(context).getInstance()\n\n        });\n\n        if (dashManifestModel.getIsTextTrack(type)) {\n            eventBus.on(Events.TIMED_TEXT_REQUESTED, onTimedTextRequested, this);\n        }\n\n        //eventBus.on(Events.LIVE_EDGE_SEARCH_COMPLETED, onLiveEdgeSearchCompleted, this);\n        eventBus.on(Events.QUALITY_CHANGE_REQUESTED, onQualityChanged, this);\n        eventBus.on(Events.DATA_UPDATE_STARTED, onDataUpdateStarted, this);\n        eventBus.on(Events.DATA_UPDATE_COMPLETED, onDataUpdateCompleted, this);\n        eventBus.on(Events.FRAGMENT_LOADING_COMPLETED, onFragmentLoadingCompleted, this);\n        eventBus.on(Events.STREAM_COMPLETED, onStreamCompleted, this);\n        eventBus.on(Events.STREAM_INITIALIZED, onStreamInitialized, this);\n        eventBus.on(Events.BUFFER_LEVEL_STATE_CHANGED, onBufferLevelStateChanged, this);\n        eventBus.on(Events.BUFFER_CLEARED, onBufferCleared, this);\n        eventBus.on(Events.BYTES_APPENDED, onBytesAppended, this);\n        eventBus.on(Events.INIT_REQUESTED, onInitRequested, this);\n        eventBus.on(Events.QUOTA_EXCEEDED, onQuotaExceeded, this);\n        eventBus.on(Events.BUFFER_LEVEL_STATE_CHANGED, onBufferLevelStateChanged, this);\n        eventBus.on(Events.PLAYBACK_SEEKING, onPlaybackSeeking, this);\n        eventBus.on(Events.PLAYBACK_STARTED, onPlaybackStarted, this);\n        eventBus.on(Events.PLAYBACK_RATE_CHANGED, onPlaybackRateChanged, this);\n        eventBus.on(Events.PLAYBACK_TIME_UPDATED, onPlaybackTimeUpdated, this);\n        eventBus.on(Events.URL_RESOLUTION_FAILED, onURLResolutionFailed, this);\n        eventBus.on(Events.FRAGMENT_LOADING_ABANDONED, onFragmentLoadingAbandoned, this);\n    }\n\n    function start() {\n        if (!currentRepresentationInfo || bufferController.getIsBufferingCompleted()) return;\n        addPlaylistTraceMetrics();\n        isStopped = false;\n\n        if (initialRequest) {\n            initialRequest = false;\n            getInitRequest(currentRepresentationInfo.quality);\n        } else {\n            startScheduleTimer(0);\n        }\n        log('Schedule controller starting for ' + type);\n    }\n\n    function stop() {\n        if (isStopped) return;\n        isStopped = true;\n        clearTimeout(scheduleTimeout);\n        log('Schedule controller stopping for ' + type);\n    }\n\n    function hasTopQualityChanged(type, id) {\n\n        topQualityIndex[id] = topQualityIndex[id] || {};\n        const newTopQualityIndex = abrController.getTopQualityIndexFor(type,id);\n\n        if ( topQualityIndex[id][type] != newTopQualityIndex ) {\n            log('Top quality'  + type + ' index has changed from ' + topQualityIndex[id][type] + ' to ' + newTopQualityIndex);\n            topQualityIndex[id][type] = newTopQualityIndex;\n            return true;\n        }\n        return false;\n\n    }\n\n    function schedule() {\n\n        if (isStopped || isFragmentProcessingInProgress || !bufferController || playbackController.isPaused() && !scheduleWhilePaused) return;\n\n        validateExecutedFragmentRequest();\n\n        const isReplacement = replaceRequestArray.length > 0;\n        if ( isReplacement ||\n             hasTopQualityChanged(currentRepresentationInfo.mediaInfo.type, streamProcessor.getStreamInfo().id) ||\n             bufferLevelRule.execute(streamProcessor, type, streamController.isVideoTrackPresent())\n           ) {\n\n            const getNextFragment = function () {\n                if (currentRepresentationInfo.quality !== lastInitQuality) {\n                    lastInitQuality = currentRepresentationInfo.quality;\n                    bufferController.switchInitData(streamProcessor.getStreamInfo().id, currentRepresentationInfo.quality);\n                } else {\n                    const replacement = replaceRequestArray.shift();\n\n                    if (fragmentController.isInitializationRequest(replacement)) {\n                        getInitRequest(replacement.quality);\n                    } else {\n                        const request = nextFragmentRequestRule.execute(streamProcessor, replacement);\n                        if (request) {\n                            fragmentModel.executeRequest(request);\n                        } else { //Use case - Playing at the bleeding live edge and frag is not available yet. Cycle back around.\n                            isFragmentProcessingInProgress = false;\n                            startScheduleTimer(500);\n                        }\n                    }\n                }\n            };\n\n            isFragmentProcessingInProgress = true;\n            if (isReplacement) {\n                getNextFragment();\n            } else {\n                abrController.getPlaybackQuality(streamProcessor);\n                getNextFragment();\n            }\n\n        } else {\n            startScheduleTimer(500);\n        }\n    }\n\n    function validateExecutedFragmentRequest() {\n        //Validate that the fragment request executed and appended into the source buffer is as\n        // good of quality as the current quality and is the correct media track.\n        const safeBufferLevel = currentRepresentationInfo.fragmentDuration * 1.5;\n        const request = fragmentModel.getRequests({state: FragmentModel.FRAGMENT_MODEL_EXECUTED, time: playbackController.getTime() + safeBufferLevel, threshold: 0})[0];\n\n        if (request && replaceRequestArray.indexOf(request) === -1 && !dashManifestModel.getIsTextTrack(type)) {\n            if (!mediaController.isCurrentTrack(request.mediaInfo) || mediaPlayerModel.getFastSwitchEnabled() && request.quality < currentRepresentationInfo.quality &&\n                bufferController.getBufferLevel() >= safeBufferLevel && abrController.getAbandonmentStateFor(type) !== AbrController.ABANDON_LOAD) {\n                replaceRequest(request);\n                log('Reloading outdated fragment at index: ', request.index);\n            } else if (request.quality > currentRepresentationInfo.quality) {\n                //The buffer has better quality it in then what we would request so set append point to end of buffer!!\n                setSeekTarget(playbackController.getTime() + bufferController.getBufferLevel());\n            }\n        }\n    }\n\n    function startScheduleTimer(value) {\n        clearTimeout(scheduleTimeout);\n        scheduleTimeout = setTimeout(schedule, value);\n    }\n\n    function onInitRequested(e) {\n        if (e.sender.getStreamProcessor() !== streamProcessor) return;\n        getInitRequest(currentRepresentationInfo.quality);\n    }\n\n    function getInitRequest(quality) {\n        lastInitQuality = quality;\n\n        const request = adapter.getInitRequest(streamProcessor, quality);\n        if (request) {\n            isFragmentProcessingInProgress = true;\n            fragmentModel.executeRequest(request);\n        }\n    }\n\n    function replaceRequest(request) {\n        replaceRequestArray.push(request);\n    }\n\n    function onQualityChanged(e) {\n        if (type !== e.mediaType || streamProcessor.getStreamInfo().id !== e.streamInfo.id) return;\n\n        currentRepresentationInfo = streamProcessor.getRepresentationInfoForQuality(e.newQuality);\n\n        if (currentRepresentationInfo === null || currentRepresentationInfo === undefined) {\n            throw new Error('Unexpected error! - currentRepresentationInfo is null or undefined');\n        }\n\n        clearPlayListTraceMetrics(new Date(), PlayListTrace.REPRESENTATION_SWITCH_STOP_REASON);\n        addPlaylistTraceMetrics();\n    }\n\n    function completeQualityChange(trigger) {\n        const item = fragmentModel.getRequests({state: FragmentModel.FRAGMENT_MODEL_EXECUTED, time: playbackController.getTime(), threshold: 0})[0];\n        if (item && playbackController.getTime() >= item.startTime ) {\n            if (item.quality !== lastQualityIndex && trigger) {\n                eventBus.trigger(Events.QUALITY_CHANGE_RENDERED, {mediaType: type, oldQuality: lastQualityIndex, newQuality: item.quality});\n            }\n            lastQualityIndex = item.quality;\n        }\n    }\n\n    function onDataUpdateCompleted(e) {\n        if (e.error || e.sender.getStreamProcessor() !== streamProcessor) return;\n        currentRepresentationInfo = adapter.convertDataToTrack(manifestModel.getValue(), e.currentRepresentation);\n    }\n\n    function onStreamInitialized(e) {\n        if (e.error || streamProcessor.getStreamInfo().id !== e.streamInfo.id) return;\n        currentRepresentationInfo = streamProcessor.getCurrentRepresentationInfo();\n\n        if (isDynamic && initialRequest) {\n            timelineConverter.setTimeSyncCompleted(true);\n            setLiveEdgeSeekTarget();\n        }\n\n        if (isStopped) {\n            start();\n        }\n    }\n\n    function setLiveEdgeSeekTarget() {\n        const liveEdge = LiveEdgeFinder(context).getInstance().getLiveEdge();\n        const dvrWindowSize = currentRepresentationInfo.mediaInfo.streamInfo.manifestInfo.DVRWindowSize / 2;\n        const startTime = liveEdge - playbackController.computeLiveDelay(currentRepresentationInfo.fragmentDuration, dvrWindowSize);\n        const request = adapter.getFragmentRequestForTime(streamProcessor, currentRepresentationInfo, startTime, {ignoreIsFinished: true});\n        seekTarget = playbackController.getLiveStartTime();\n        if (isNaN(seekTarget) || request.startTime > seekTarget) {\n            playbackController.setLiveStartTime(request.startTime);\n            seekTarget = request.startTime;\n        }\n\n        const manifestUpdateInfo = dashMetrics.getCurrentManifestUpdate(metricsModel.getMetricsFor('stream'));\n        metricsModel.updateManifestUpdateInfo(manifestUpdateInfo, {\n            currentTime: seekTarget,\n            presentationStartTime: liveEdge,\n            latency: liveEdge - seekTarget,\n            clientTimeOffset: timelineConverter.getClientTimeOffset()\n        });\n    }\n\n    function onStreamCompleted(e) {\n        if (e.fragmentModel !== fragmentModel) return;\n        stop();\n        isFragmentProcessingInProgress = false;\n        log('Stream is complete');\n    }\n\n    function onFragmentLoadingCompleted(e) {\n        if (e.sender !== fragmentModel) return;\n\n        if (dashManifestModel.getIsTextTrack(type)) {\n            isFragmentProcessingInProgress = false;\n        }\n\n        if (e.error && e.request.serviceLocation && !isStopped) {\n            replaceRequest(e.request);\n            isFragmentProcessingInProgress = false;\n            startScheduleTimer(0);\n        }\n    }\n\n    function onPlaybackTimeUpdated() {\n        completeQualityChange(true);\n    }\n\n    function onBytesAppended(e) {\n        if (e.sender.getStreamProcessor() !== streamProcessor) return;\n        isFragmentProcessingInProgress = false;\n        startScheduleTimer(0);\n    }\n\n    function onFragmentLoadingAbandoned(e) {\n        if (e.streamProcessor !== streamProcessor) return;\n        replaceRequest(e.request);\n        isFragmentProcessingInProgress = false;\n        startScheduleTimer(0);\n    }\n\n    function onDataUpdateStarted(e) {\n        if (e.sender.getStreamProcessor() !== streamProcessor) return;\n        stop();\n    }\n\n    function onBufferCleared(e) {\n        if (e.sender.getStreamProcessor() !== streamProcessor) return;\n        // after the data has been removed from the buffer we should remove the requests from the list of\n        // the executed requests for which playback time is inside the time interval that has been removed from the buffer\n        fragmentModel.removeExecutedRequestsBeforeTime(e.to);\n\n        if (e.hasEnoughSpaceToAppend && isStopped) {\n            start();\n        }\n    }\n\n    function onBufferLevelStateChanged(e) {\n        if ((e.sender.getStreamProcessor() === streamProcessor) && e.state === BufferController.BUFFER_EMPTY && !playbackController.isSeeking()) {\n            log('Buffer is empty! Stalling!');\n            clearPlayListTraceMetrics(new Date(), PlayListTrace.REBUFFERING_REASON);\n        }\n    }\n\n    function onQuotaExceeded(e) {\n        if (e.sender.getStreamProcessor() !== streamProcessor) return;\n        stop();\n    }\n\n    function onURLResolutionFailed() {\n        fragmentModel.abortRequests();\n        stop();\n    }\n\n    function onTimedTextRequested(e) {\n        if (e.sender.getStreamProcessor() !== streamProcessor) return;\n        getInitRequest(e.index);\n    }\n\n    function onPlaybackStarted() {\n        if (isStopped || !scheduleWhilePaused) {\n            start();\n        }\n    }\n\n    function onPlaybackSeeking(e) {\n\n        seekTarget = e.seekTime;\n        setTimeToLoadDelay(0);\n\n        if (isStopped) {\n            start();\n        }\n\n        const manifestUpdateInfo = dashMetrics.getCurrentManifestUpdate(metricsModel.getMetricsFor('stream'));\n        const latency = currentRepresentationInfo.DVRWindow ? currentRepresentationInfo.DVRWindow.end - playbackController.getTime() : NaN;\n        metricsModel.updateManifestUpdateInfo(manifestUpdateInfo, {latency: latency});\n    }\n\n    function onPlaybackRateChanged(e) {\n        if (playListTraceMetrics) {\n            playListTraceMetrics.playbackspeed = e.playbackRate.toString();\n        }\n    }\n\n    function getSeekTarget() {\n        return seekTarget;\n    }\n\n    function setSeekTarget(value) {\n        seekTarget = value;\n    }\n\n    function getFragmentModel() {\n        return fragmentModel;\n    }\n\n    function setTimeToLoadDelay(value) {\n        timeToLoadDelay = value;\n    }\n\n    function getTimeToLoadDelay() {\n        return timeToLoadDelay;\n    }\n\n    function getStreamProcessor() {\n        return streamProcessor;\n    }\n\n    function getBufferTarget() {\n        return bufferLevelRule.getBufferTarget(streamProcessor, type, streamController.isVideoTrackPresent());\n    }\n\n    function setPlayList(playList) {\n        playListMetrics = playList;\n    }\n\n    function finalisePlayList(time, reason) {\n        clearPlayListTraceMetrics(time, reason);\n        playListMetrics = null;\n    }\n\n    function clearPlayListTraceMetrics(endTime, stopreason) {\n        if (playListMetrics && playListTraceMetricsClosed === false) {\n            const startTime = playListTraceMetrics.start;\n            const duration = endTime.getTime() - startTime.getTime();\n            playListTraceMetrics.duration = duration;\n            playListTraceMetrics.stopreason = stopreason;\n            playListMetrics.trace.push(playListTraceMetrics);\n            playListTraceMetricsClosed = true;\n        }\n    }\n\n    function addPlaylistTraceMetrics() {\n        if (playListMetrics && playListTraceMetricsClosed === true && currentRepresentationInfo) {\n            playListTraceMetricsClosed = false;\n            playListTraceMetrics = new PlayListTrace();\n            playListTraceMetrics.representationid = currentRepresentationInfo.id;\n            playListTraceMetrics.start = new Date();\n            playListTraceMetrics.mstart = playbackController.getTime() * 1000;\n            playListTraceMetrics.playbackspeed = playbackController.getPlaybackRate().toString();\n        }\n    }\n\n    function reset() {\n        //eventBus.off(Events.LIVE_EDGE_SEARCH_COMPLETED, onLiveEdgeSearchCompleted, this);\n        eventBus.off(Events.DATA_UPDATE_STARTED, onDataUpdateStarted, this);\n        eventBus.off(Events.DATA_UPDATE_COMPLETED, onDataUpdateCompleted, this);\n        eventBus.off(Events.BUFFER_LEVEL_STATE_CHANGED, onBufferLevelStateChanged, this);\n        eventBus.off(Events.QUALITY_CHANGE_REQUESTED, onQualityChanged, this);\n        eventBus.off(Events.FRAGMENT_LOADING_COMPLETED, onFragmentLoadingCompleted, this);\n        eventBus.off(Events.STREAM_COMPLETED, onStreamCompleted, this);\n        eventBus.off(Events.STREAM_INITIALIZED, onStreamInitialized, this);\n        eventBus.off(Events.QUOTA_EXCEEDED, onQuotaExceeded, this);\n        eventBus.off(Events.BYTES_APPENDED, onBytesAppended, this);\n        eventBus.off(Events.BUFFER_CLEARED, onBufferCleared, this);\n        eventBus.off(Events.INIT_REQUESTED, onInitRequested, this);\n        eventBus.off(Events.PLAYBACK_RATE_CHANGED, onPlaybackRateChanged, this);\n        eventBus.off(Events.PLAYBACK_SEEKING, onPlaybackSeeking, this);\n        eventBus.off(Events.PLAYBACK_STARTED, onPlaybackStarted, this);\n        eventBus.off(Events.PLAYBACK_TIME_UPDATED, onPlaybackTimeUpdated, this);\n        eventBus.off(Events.URL_RESOLUTION_FAILED, onURLResolutionFailed, this);\n        eventBus.off(Events.FRAGMENT_LOADING_ABANDONED, onFragmentLoadingAbandoned, this);\n        if (dashManifestModel.getIsTextTrack(type)) {\n            eventBus.off(Events.TIMED_TEXT_REQUESTED, onTimedTextRequested, this);\n        }\n\n        stop();\n        completeQualityChange(false);\n        isFragmentProcessingInProgress = false;\n        timeToLoadDelay = 0;\n        seekTarget = NaN;\n        playbackController = null;\n        playListMetrics = null;\n    }\n\n    instance = {\n        initialize: initialize,\n        getStreamProcessor: getStreamProcessor,\n        getSeekTarget: getSeekTarget,\n        setSeekTarget: setSeekTarget,\n        getFragmentModel: getFragmentModel,\n        setTimeToLoadDelay: setTimeToLoadDelay,\n        getTimeToLoadDelay: getTimeToLoadDelay,\n        replaceRequest: replaceRequest,\n        start: start,\n        stop: stop,\n        reset: reset,\n        setPlayList: setPlayList,\n        getBufferTarget: getBufferTarget,\n        finalisePlayList: finalisePlayList\n    };\n\n    setup();\n\n    return instance;\n}\n\nScheduleController.__dashjs_factory_name = 'ScheduleController';\nexport default FactoryMaker.getClassFactory(ScheduleController);\n"]}