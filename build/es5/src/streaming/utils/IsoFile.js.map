{"version":3,"sources":["../../../../../src/streaming/utils/IsoFile.js"],"names":[],"mappings":"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","file":"IsoFile.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport IsoBox from '../vo/IsoBox';\nimport FactoryMaker from '../../core/FactoryMaker';\n\nfunction IsoFile() {\n\n    let instance,\n        parsedIsoFile,\n        commonProps,\n        sidxProps,\n        sidxRefProps,\n        emsgProps,\n        mdhdProps,\n        mfhdProps,\n        subsProps,\n        tfhdProps,\n        tfdtProps,\n        trunProps,\n        trunSampleProps;\n\n    /**\n    * @param {string} type\n    * @returns {IsoBox|null}\n    * @memberof IsoFile#\n    */\n    function getBox(type) {\n        if (!type || !parsedIsoFile || !parsedIsoFile.boxes || (parsedIsoFile.boxes.length === 0)) return null;\n\n        return convertToDashIsoBox(parsedIsoFile.fetch(type));\n    }\n\n    /**\n    * @param {string} type\n    * @returns {Array} array of {@link IsoBox}\n    * @memberof IsoFile#\n    */\n    function getBoxes(type) {\n        var boxData = parsedIsoFile.fetchAll(type);\n        var boxes = [];\n        var box;\n\n        for (var i = 0, ln = boxData.length; i < ln; i++) {\n            box = convertToDashIsoBox(boxData[i]);\n\n            if (box) {\n                boxes.push(box);\n            }\n        }\n\n        return boxes;\n    }\n\n    /**\n    * @param {string} value\n    * @memberof IsoFile#\n    */\n    function setData(value) {\n        parsedIsoFile = value;\n    }\n\n    /**\n    * @returns {IsoBox|null}\n    * @memberof IsoFile#\n    */\n    function getLastBox() {\n        if (!parsedIsoFile || !parsedIsoFile.boxes || !parsedIsoFile.boxes.length) return null;\n\n        var type = parsedIsoFile.boxes[parsedIsoFile.boxes.length - 1].type;\n        var boxes = getBoxes(type);\n\n        return boxes[boxes.length - 1];\n    }\n\n    /**\n    * @returns {number}\n    * @memberof IsoFile#\n    */\n    function getOffset() {\n        return parsedIsoFile._cursor.offset;\n    }\n\n    function setup() {\n        commonProps = {\n            offset: '_offset',\n            size: 'size',\n            type: 'type'\n        };\n\n        sidxProps = {\n            references: 'references',\n            timescale: 'timescale',\n            earliest_presentation_time: 'earliest_presentation_time',\n            first_offset: 'first_offset'\n        };\n\n        sidxRefProps = {\n            reference_type: 'reference_type',\n            referenced_size: 'referenced_size',\n            subsegment_duration: 'subsegment_duration'\n        };\n\n        emsgProps = {\n            id: 'id',\n            value: 'value',\n            timescale: 'timescale',\n            scheme_id_uri: 'scheme_id_uri',\n            presentation_time_delta: 'presentation_time_delta',\n            event_duration: 'event_duration',\n            message_data: 'message_data'\n        };\n\n        mdhdProps = {\n            timescale: 'timescale'\n        };\n\n        mfhdProps = {\n            sequence_number: 'sequence_number'\n        };\n\n        subsProps = {\n            samples_with_subsamples: 'samples_with_subsamples'\n        };\n\n        tfhdProps = {\n            base_data_offset: 'base_data_offset',\n            sample_description_index: 'sample_description_index',\n            default_sample_duration: 'default_sample_duration',\n            default_sample_size: 'default_sample_size',\n            default_sample_flags: 'default_sample_flags',\n            flags: 'flags'\n        };\n\n        tfdtProps = {\n            version: 'version',\n            baseMediaDecodeTime: 'baseMediaDecodeTime',\n            flags: 'flags'\n        };\n\n        trunProps = {\n            sample_count: 'sample_count',\n            first_sample_flags: 'first_sample_flags',\n            data_offset: 'data_offset',\n            flags: 'flags',\n            samples: 'samples'\n        };\n\n        trunSampleProps = {\n            sample_size: 'sample_size',\n            sample_duration: 'sample_duration',\n            sample_composition_time_offset: 'sample_composition_time_offset'\n        };\n    }\n\n    function copyProps(from, to, props) {\n        for (var prop in props) {\n            to[prop] = from[props[prop]];\n        }\n    }\n\n    function convertToDashIsoBox(boxData) {\n        if (!boxData) return null;\n\n        var box = new IsoBox();\n        var i,\n            ln;\n\n        copyProps(boxData, box, commonProps);\n\n        if (boxData.hasOwnProperty('_incomplete')) {\n            box.isComplete = !boxData._incomplete;\n        }\n\n        switch (box.type) {\n            case 'sidx':\n                copyProps(boxData, box, sidxProps);\n                if (box.references) {\n                    for (i = 0, ln = box.references.length; i < ln; i++) {\n                        copyProps(boxData.references[i], box.references[i], sidxRefProps);\n                    }\n                }\n                break;\n            case 'emsg':\n                copyProps(boxData, box, emsgProps);\n                break;\n            case 'mdhd':\n                copyProps(boxData, box, mdhdProps);\n                break;\n            case 'mfhd':\n                copyProps(boxData, box, mfhdProps);\n                break;\n            case 'subs':\n                copyProps(boxData, box, subsProps);\n                break;\n            case 'tfhd':\n                copyProps(boxData, box, tfhdProps);\n                break;\n            case 'tfdt':\n                copyProps(boxData, box, tfdtProps);\n                break;\n            case 'trun':\n                copyProps(boxData, box, trunProps);\n                if (box.samples) {\n                    for (i = 0, ln = box.samples.length; i < ln; i++) {\n                        copyProps(boxData.samples[i], box.samples[i], trunSampleProps);\n                    }\n                }\n                break;\n        }\n\n        return box;\n    }\n\n    instance = {\n        getBox: getBox,\n        getBoxes: getBoxes,\n        setData: setData,\n        getLastBox: getLastBox,\n        getOffset: getOffset\n    };\n\n    setup();\n\n    return instance;\n}\nIsoFile.__dashjs_factory_name = 'IsoFile';\nexport default FactoryMaker.getClassFactory(IsoFile);\n"]}